<div class="side-cart-overlay" [class.active]="carritoService.carritoAbierto()" (click)="cerrar()"></div>

<div class="side-cart" [class.active]="carritoService.carritoAbierto()">
  <div class="side-cart-header">
    <h2>Mi Carrito</h2>
    <button class="btn-close" (click)="cerrar()">×</button>
  </div>

  <div class="side-cart-body">
    @if (carritoService.items().length === 0) {
      <div class="carrito-vacio">
        <p>Tu carrito está vacío</p>
        <a routerLink="/productos" (click)="cerrar()" class="btn-continuar">Ver Productos</a>
      </div>
    } @else {
      <div class="items-lista">
        @for (item of carritoService.items(); track item.talle ? item.producto.id + '_' + item.talle.id : item.producto.id) {
          <div class="item-carrito">
            <div class="item-imagen">
              <img [src]="item.producto.imagenes?.[0]?.url || 'https://via.placeholder.com/80'" [alt]="item.producto.nombre" />
            </div>

            <div class="item-info">
              <h3>{{ item.producto.nombre }}</h3>
              @if (item.talle) {
                <p class="item-talle">
                  <span class="talle-badge">{{ item.talle.codigo }}</span>
                  <span class="talle-nombre">{{ item.talle.nombre }}</span>
                </p>
              }
              <p class="item-precio">${{ item.precio_unitario || item.producto.precio | number:'1.2-2' }} c/u</p>

              <div class="item-actions">
                <div class="item-cantidad">
                  <button (click)="disminuirCantidad(item.producto.id, item.cantidad, item.talle?.id)" class="btn-cantidad" [disabled]="eliminandoId() === (item.talle ? item.producto.id + '_' + item.talle.id : item.producto.id)">-</button>
                  <span class="cantidad">{{ item.cantidad }}</span>
                  <button (click)="aumentarCantidad(item.producto.id, item.cantidad, item.talle?.id)" class="btn-cantidad" [disabled]="eliminandoId() === (item.talle ? item.producto.id + '_' + item.talle.id : item.producto.id)">+</button>
                </div>
                <span class="item-subtotal">${{ item.subtotal | number:'1.2-2' }}</span>
                @if (eliminandoId() === (item.talle ? item.producto.id + '_' + item.talle.id : item.producto.id)) {
                  <span class="eliminando">Eliminando...</span>
                } @else {
                  <button (click)="eliminarProducto(item.producto.id, item.talle?.id)" class="btn-eliminar" aria-label="Eliminar producto">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  @if (carritoService.items().length > 0) {
    <div class="side-cart-footer">
      <div class="total-line">
        <span>Subtotal:</span>
        <span class="total-valor">${{ carritoService.subtotal() | number:'1.2-2' }}</span>
      </div>
      <button (click)="vaciarCarrito()" class="btn-vaciar">Vaciar Carrito</button>
      <a routerLink="/productos" (click)="cerrar()" class="btn-continuar-comprando">Seguir Comprando</a>
      <a routerLink="/checkout" (click)="cerrar()" class="btn-checkout">Finalizar Pedido</a>
    </div>
  }
</div>

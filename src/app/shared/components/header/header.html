<header class="header">
  <div class="header-container">
    <div class="logo">
      <a routerLink="/" (click)="cerrarMenu()">
        <img src="/images/LOGOSUBLISA.png" alt="Sublisa Logo" class="logo-image">
      </a>
    </div>

    <button (click)="carritoService.abrirCarrito()" class="carrito-mobile">
      üõí
      @if (carritoService.cantidadTotal() > 0) {
        <span class="badge-mobile">{{ carritoService.cantidadTotal() }}</span>
      }
    </button>

    <button class="menu-toggle" (click)="toggleMenu()" [class.active]="menuAbierto">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="nav" [class.open]="menuAbierto">
      <div class="nav-item-dropdown"
           (mouseenter)="menuProductosAbierto.set(true)"
           (mouseleave)="cerrarMenuProductos()">
        <a routerLink="/productos"
           routerLinkActive="active"
           (click)="toggleMenuProductos(); $event.preventDefault()"
           class="nav-link productos-link">
          Productos ‚ñæ
        </a>
        <div class="dropdown-menu" [class.show]="menuProductosAbierto()">
          @for (categoria of categorias(); track categoria.nombre) {
            <div class="dropdown-item-with-submenu"
                 (mouseenter)="onCategoriaHover(categoria.nombre)"
                 (mouseleave)="onCategoriaHover(null)">
              <a [routerLink]="['/productos']"
                 [queryParams]="{categoria: categoria.nombre}"
                 (click)="cerrarMenu()"
                 class="dropdown-item">
                {{ categoria.nombre }} ‚Üí
              </a>

              <!-- Submenu de subcategor√≠as -->
              @if (categoriaHover() === categoria.nombre) {
                <div class="dropdown-submenu">
                  @for (subcategoria of categoria.subcategorias; track subcategoria.nombre) {
                    <a [routerLink]="['/productos']"
                       [queryParams]="{categoria: categoria.nombre, subcategoria: subcategoria.nombre}"
                       (click)="cerrarMenu()"
                       class="dropdown-subitem">
                      {{ subcategoria.nombre }}
                    </a>
                  }
                </div>
              }
            </div>
          }
        </div>
      </div>

      <a routerLink="/quienes-somos" routerLinkActive="active" (click)="cerrarMenu()" class="nav-link">
        Qui√©nes Somos
      </a>

      <a routerLink="/como-comprar" routerLinkActive="active" (click)="cerrarMenu()" class="nav-link">
        C√≥mo Comprar
      </a>

      <button (click)="carritoService.toggleCarrito(); cerrarMenu()" class="nav-link carrito-link carrito-btn">
        üõí Carrito
        @if (carritoService.cantidadTotal() > 0) {
          <span class="badge">{{ carritoService.cantidadTotal() }}</span>
        }
      </button>

      <!-- Mostrar seg√∫n estado de autenticaci√≥n y rol -->
      @if (authService.isAuthenticatedSignal$()()) {
        @if (authService.isAdmin()) {
          <a routerLink="/admin/dashboard" routerLinkActive="active" (click)="cerrarMenu()" class="nav-link admin-link">
            üîê Admin
          </a>
        } @else {
          <a routerLink="/mi-cuenta" routerLinkActive="active" (click)="cerrarMenu()" class="nav-link cuenta-link">
            üë§ Mi Cuenta
          </a>
        }
        <button (click)="logout()" class="nav-link logout-btn">
          üö™ Cerrar Sesi√≥n
        </button>
      } @else {
        <a routerLink="/login" routerLinkActive="active" (click)="cerrarMenu()" class="nav-link login-link">
          üîë Iniciar Sesi√≥n
        </a>
      }
    </nav>
  </div>
</header>

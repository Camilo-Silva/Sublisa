<div class="producto-form-container">
  <div class="page-header">
    <h1>
      {{ isEditMode() ? '‚úèÔ∏è Editar Producto' : '‚ûï Nuevo Producto' }}
    </h1>
    <a routerLink="/admin/productos" class="btn-volver">
      ‚Üê Volver a Productos
    </a>
  </div>

  @if (loading() && isEditMode()) {
    <div class="loading-state">
      <p>Cargando producto...</p>
    </div>
  } @else {
    <form (ngSubmit)="onSubmit()" class="producto-form">
      @if (error()) {
        <div class="error-message">
          ‚ùå {{ error() }}
        </div>
      }

      <div class="form-section">
        <h2>üìù Informaci√≥n B√°sica</h2>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="nombre">Nombre del Producto *</label>
            <input
              type="text"
              id="nombre"
              name="nombre"
              [(ngModel)]="formData().nombre"
              required
              placeholder="Ej: Remera Lisa Sublimable"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="descripcion">Descripci√≥n</label>
            <textarea
              id="descripcion"
              name="descripcion"
              [(ngModel)]="formData().descripcion"
              rows="4"
              placeholder="Descripci√≥n detallada del producto..."
            ></textarea>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="sku">SKU / C√≥digo</label>
            <input
              type="text"
              id="sku"
              name="sku"
              [(ngModel)]="formData().sku"
              placeholder="Ej: REM-SUB-001"
            />
          </div>

          <div class="form-group">
            <label for="categoria">Categor√≠a</label>
            <input
              type="text"
              id="categoria"
              name="categoria"
              [(ngModel)]="formData().categoria"
              placeholder="Ej: Textiles, Tazas, etc."
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2>üí∞ Precio e Inventario</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="precio">Precio ($) *</label>
            <input
              type="number"
              id="precio"
              name="precio"
              [(ngModel)]="formData().precio"
              required
              min="0"
              step="0.01"
              placeholder="0.00"
            />
          </div>

          <div class="form-group">
            <label for="stock">Stock *</label>
            <input
              type="number"
              id="stock"
              name="stock"
              [(ngModel)]="formData().stock"
              required
              min="0"
              placeholder="0"
            />
          </div>
        </div>
      </div>

      <div class="form-section">
        <h2>üñºÔ∏è Im√°genes</h2>

        @if (isEditMode() && imagenes().length > 0) {
          <div class="imagenes-existentes">
            <h3>Im√°genes Actuales</h3>
            <div class="imagenes-grid">
              @for (imagen of imagenes(); track imagen.id) {
                <div class="imagen-item" [class.principal]="imagen.es_principal">
                  <img [src]="imagen.url" [alt]="formData().nombre" />
                  @if (imagen.es_principal) {
                    <div class="badge-principal">‚≠ê Principal</div>
                  }
                  <div class="imagen-acciones">
                    @if (!imagen.es_principal) {
                      <button
                        type="button"
                        (click)="setImagenPrincipal(imagen.id)"
                        class="btn-set-principal"
                        title="Marcar como principal"
                      >
                        ‚≠ê
                      </button>
                    }
                    <button
                      type="button"
                      (click)="removeExistingImage(imagen.id, imagen.url)"
                      class="btn-remove-imagen"
                      title="Eliminar imagen"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <div class="upload-section">
          <label class="upload-label">
            <input
              type="file"
              accept="image/*"
              multiple
              (change)="onFileSelected($event)"
              hidden
              #fileInput
            />
            <div class="upload-box">
              <span class="upload-icon">üìé</span>
              <span class="upload-text">Haz clic para seleccionar im√°genes</span>
              <span class="upload-hint">Puedes seleccionar m√∫ltiples archivos</span>
            </div>
          </label>
        </div>

        @if (previewUrls().length > 0) {
          <div class="imagenes-preview">
            <h3>Nuevas Im√°genes a Subir</h3>
            <div class="imagenes-grid">
              @for (url of previewUrls(); track $index) {
                <div class="imagen-item preview">
                  <img [src]="url" alt="Preview" />
                  <button
                    type="button"
                    (click)="removePreview($index)"
                    class="btn-remove-preview"
                    title="Quitar"
                  >
                    ‚ùå
                  </button>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <div class="form-actions">
        <a routerLink="/admin/productos" class="btn-cancelar">
          Cancelar
        </a>
        <button
          type="submit"
          class="btn-guardar"
          [disabled]="loading() || uploadingImages()"
        >
          @if (uploadingImages()) {
            <span>üìé Subiendo im√°genes...</span>
          } @else if (loading()) {
            <span>Guardando...</span>
          } @else {
            <span>‚úîÔ∏è {{ isEditMode() ? 'Actualizar' : 'Crear' }} Producto</span>
          }
        </button>
      </div>
    </form>
  }
</div>

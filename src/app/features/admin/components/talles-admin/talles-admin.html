<div class="talles-admin-container">
  <div class="page-header">
    <div class="header-content">
      <h1>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        Gestión de Talles
      </h1>
      <p class="subtitle">Administra los talles disponibles para tus productos</p>
    </div>
    <div class="header-actions">
      <button (click)="nuevoTalle()" class="btn-nuevo">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Nuevo Talle
    </button>
      <a routerLink="/admin/dashboard" class="btn-volver">
        ← Volver al Dashboard
      </a>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando talles...</p>
    </div>
  } @else {
    @if (talles().length === 0) {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <h3>No hay talles registrados</h3>
        <p>Comienza creando tu primer talle</p>
        <button (click)="nuevoTalle()" class="btn-primary">
          Crear Primer Talle
        </button>
      </div>
    } @else {
      <div class="talles-grid">
        @for (talle of talles(); track talle.id) {
          <div class="talle-card" [class.inactivo]="!talle.activo">
            <div class="talle-header">
              <div class="talle-codigo">{{ talle.codigo }}</div>
              <div class="talle-estado">
                <span
                  class="badge"
                  [class.activo]="talle.activo"
                  [class.inactivo]="!talle.activo"
                >
                  {{ talle.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </div>
            </div>

            <div class="talle-body">
              <h3>{{ talle.nombre }}</h3>
              <div class="talle-info">
                <span class="orden">Orden: {{ talle.orden }}</span>
              </div>
            </div>

            <div class="talle-actions">
              <button
                (click)="editarTalle(talle)"
                class="btn-action btn-editar"
                title="Editar"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>

              <button
                (click)="verProductosConTalle(talle)"
                class="btn-action btn-info"
                title="Ver productos"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="16" x2="12" y2="12"></line>
                  <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
              </button>

              <button
                (click)="cambiarEstado(talle)"
                class="btn-action"
                [class.btn-activar]="!talle.activo"
                [class.btn-desactivar]="talle.activo"
                [title]="talle.activo ? 'Desactivar' : 'Activar'"
              >
                @if (talle.activo) {
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="15" y1="9" x2="9" y2="15"></line>
                    <line x1="9" y1="9" x2="15" y2="15"></line>
                  </svg>
                } @else {
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                }
              </button>

              <button
                (click)="eliminarTalle(talle)"
                class="btn-action btn-eliminar"
                title="Eliminar"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
              </button>
            </div>
          </div>
        }
      </div>

      <div class="talles-summary">
        <p>
          <strong>Total de talles:</strong> {{ talles().length }}
          <span class="separator">•</span>
          <strong>Activos:</strong> {{ tallesActivos }}
          <span class="separator">•</span>
          <strong>Inactivos:</strong> {{ tallesInactivos }}
        </p>
      </div>
    }
  }

  <!-- Modal Formulario -->
  @if (mostrarFormulario()) {
    <div class="modal-overlay" (click)="cancelar()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            {{ modoEdicion() ? 'Editar Talle' : 'Nuevo Talle' }}
          </h2>
          <button (click)="cancelar()" class="btn-close">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label for="codigo">
                Código *
                <span class="hint">Ej: XS, S, M, L, XL</span>
              </label>
              <input
                id="codigo"
                type="text"
                [(ngModel)]="formData().codigo"
                [class.error]="erroresValidacion()['codigo']"
                placeholder="S"
                maxlength="10"
              />
              @if (erroresValidacion()['codigo']) {
                <span class="error-message">{{ erroresValidacion()['codigo'] }}</span>
              }
            </div>

            <div class="form-group">
              <label for="nombre">
                Nombre *
                <span class="hint">Descripción del talle</span>
              </label>
              <input
                id="nombre"
                type="text"
                [(ngModel)]="formData().nombre"
                [class.error]="erroresValidacion()['nombre']"
                placeholder="Chico"
                maxlength="50"
              />
              @if (erroresValidacion()['nombre']) {
                <span class="error-message">{{ erroresValidacion()['nombre'] }}</span>
              }
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="orden">
                Orden
                <span class="hint">Define el orden de visualización</span>
              </label>
              <input
                id="orden"
                type="number"
                [(ngModel)]="formData().orden"
                [class.error]="erroresValidacion()['orden']"
                min="0"
              />
              @if (erroresValidacion()['orden']) {
                <span class="error-message">{{ erroresValidacion()['orden'] }}</span>
              }
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [(ngModel)]="formData().activo"
                />
                <span>Activo</span>
              </label>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button (click)="cancelar()" class="btn-cancelar">Cancelar</button>
          <button (click)="guardarTalle()" class="btn-guardar">
            {{ modoEdicion() ? 'Actualizar' : 'Crear' }} Talle
          </button>
        </div>
      </div>
    </div>
  }
</div>

<div class="productos-list-container">
  <div class="page-header">
    <div>
      <h1>üì¶ Gesti√≥n de Productos</h1>
      <p>Administra el cat√°logo de productos</p>
    </div>
    <a routerLink="/admin/productos/nuevo" class="btn-nuevo">
      ‚ûï Nuevo Producto
    </a>
  </div>

  <div class="toolbar">
    <div class="search-box">
      <input
        type="text"
        placeholder="üîç Buscar por nombre, SKU, categor√≠a..."
        [(ngModel)]="busqueda"
        (input)="filtrarProductos()"
      />
    </div>
    <a routerLink="/admin/dashboard" class="btn-volver">
      ‚Üê Volver al Dashboard
    </a>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <p>Cargando productos...</p>
    </div>
  } @else if (error()) {
    <div class="error-state">
      <p>‚ùå {{ error() }}</p>
      <button (click)="cargarProductos()" class="btn-retry">Reintentar</button>
    </div>
  } @else if (productosFiltrados().length === 0) {
    <div class="empty-state">
      <p>üì¶ No hay productos registrados</p>
      <a routerLink="/admin/productos/nuevo" class="btn-crear-primero">
        Crear primer producto
      </a>
    </div>
  } @else {
    <div class="productos-table-container">
      <table class="productos-table">
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Nombre</th>
            <th>SKU</th>
            <th>Categor√≠a</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (producto of productosFiltrados(); track producto.id) {
            <tr>
              <td>
                <div class="producto-imagen">
                  @if (producto.imagenes && producto.imagenes.length > 0) {
                    <img
                      [src]="producto.imagenes[0].url"
                      [alt]="producto.nombre"
                    />
                  } @else {
                    <div class="sin-imagen">üñºÔ∏è</div>
                  }
                </div>
              </td>
              <td>
                <div class="producto-info">
                  <strong>{{ producto.nombre }}</strong>
                  @if (producto.descripcion) {
                    <small>{{ producto.descripcion | slice:0:50 }}{{ producto.descripcion.length > 50 ? '...' : '' }}</small>
                  }
                </div>
              </td>
              <td>
                <span class="sku">{{ producto.sku || '-' }}</span>
              </td>
              <td>
                @if (producto.categoria) {
                  <span class="categoria-badge">{{ producto.categoria }}</span>
                } @else {
                  <span class="texto-muted">Sin categor√≠a</span>
                }
              </td>
              <td class="precio">
                ${{ producto.precio | number:'1.2-2' }}
              </td>
              <td>
                <span
                  class="stock-badge"
                  [ngClass]="getStockClass(producto.stock)"
                >
                  {{ producto.stock }}
                </span>
              </td>
              <td>
                <div class="acciones">
                  <button
                    (click)="editarProducto(producto.id)"
                    class="btn-editar"
                    title="Editar"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    (click)="confirmarEliminar(producto)"
                    class="btn-eliminar"
                    title="Eliminar"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="resumen">
      <p>Mostrando {{ productosFiltrados().length }} de {{ productos().length }} productos</p>
    </div>
  }

  <!-- Modal de confirmaci√≥n -->
  @if (productoAEliminar()) {
    <div class="modal-overlay" (click)="cancelarEliminar()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>‚ö†Ô∏è Confirmar Eliminaci√≥n</h2>
        </div>
        <div class="modal-body">
          <p>¬øEst√°s seguro de que deseas eliminar el producto <strong>{{ productoAEliminar()!.nombre }}</strong>?</p>
          <p class="warning-text">Esta acci√≥n no se puede deshacer y tambi√©n eliminar√° todas las im√°genes asociadas.</p>
        </div>
        <div class="modal-footer">
          <button (click)="cancelarEliminar()" class="btn-cancelar">
            Cancelar
          </button>
          <button (click)="eliminarProducto()" class="btn-confirmar-eliminar">
            Eliminar Producto
          </button>
        </div>
      </div>
    </div>
  }
</div>

<div class="pedidos-list-container">
  <div class="page-header">
    <div>
      <h1>ğŸ“‹ GestiÃ³n de Pedidos</h1>
      <p>Administra y consulta todos los pedidos</p>
    </div>
    <a routerLink="/admin/dashboard" class="btn-volver">
      â† Volver al Dashboard
    </a>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <h2>ğŸ” Filtros de BÃºsqueda</h2>

    <div class="filtros-grid">
      <div class="filtro-item">
        <label for="busqueda">Buscar</label>
        <input
          type="text"
          id="busqueda"
          placeholder="NÃºmero de pedido, cliente, telÃ©fono..."
          [(ngModel)]="busqueda"
          (input)="aplicarFiltros()"
        />
      </div>

      <div class="filtro-item">
        <label for="estado">Estado</label>
        <select
          id="estado"
          [(ngModel)]="estadoFiltro"
          (change)="aplicarFiltros()"
        >
          @for (estado of estados; track estado) {
            <option [value]="estado">{{ getEstadoTexto(estado) }}</option>
          }
        </select>
      </div>

      <div class="filtro-item">
        <label for="fechaDesde">Fecha Desde</label>
        <input
          type="date"
          id="fechaDesde"
          [(ngModel)]="fechaDesde"
          (change)="aplicarFiltros()"
        />
      </div>

      <div class="filtro-item">
        <label for="fechaHasta">Fecha Hasta</label>
        <input
          type="date"
          id="fechaHasta"
          [(ngModel)]="fechaHasta"
          (change)="aplicarFiltros()"
        />
      </div>

      <div class="filtro-item filtro-actions">
        <button (click)="limpiarFiltros()" class="btn-limpiar">
          ğŸ”„ Limpiar Filtros
        </button>
      </div>
    </div>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <p>Cargando pedidos...</p>
    </div>
  } @else if (error()) {
    <div class="error-state">
      <p>âŒ {{ error() }}</p>
      <button (click)="cargarPedidos()" class="btn-retry">Reintentar</button>
    </div>
  } @else if (pedidosFiltrados().length === 0) {
    <div class="empty-state">
      <p>ğŸ“¦ No se encontraron pedidos con los filtros aplicados</p>
      <button (click)="limpiarFiltros()" class="btn-limpiar-filtros">
        Limpiar filtros
      </button>
    </div>
  } @else {
    <!-- Resumen -->
    <div class="resumen-pedidos">
      <div class="resumen-item">
        <span class="resumen-label">Total Pedidos:</span>
        <span class="resumen-valor">{{ pedidosFiltrados().length }}</span>
      </div>
      <div class="resumen-item">
        <span class="resumen-label">Monto Total:</span>
        <span class="resumen-valor resumen-monto">${{ getTotalPedidos() | number:'1.2-2' }}</span>
      </div>
    </div>

    <!-- Tabla de pedidos -->
    <div class="pedidos-table-container">
      <table class="pedidos-table">
        <thead>
          <tr>
            <th>NÃºmero</th>
            <th>Fecha</th>
            <th>Cliente</th>
            <th>Contacto</th>
            <th>Total</th>
            <th>Estado</th>
            <th>AcciÃ³n</th>
          </tr>
        </thead>
        <tbody>
          @for (pedido of pedidosFiltrados(); track pedido.id) {
            <tr>
              <td class="pedido-numero">#{{ pedido.numero_pedido }}</td>
              <td>
                <div class="pedido-fecha">
                  <strong>{{ pedido.created_at | date:'dd/MM/yyyy' }}</strong>
                  <small>{{ pedido.created_at | date:'HH:mm' }}</small>
                </div>
              </td>
              <td>
                <strong>{{ pedido.cliente?.nombre || 'N/A' }}</strong>
              </td>
              <td>
                <div class="contacto-info">
                  @if (pedido.cliente?.telefono) {
                    <span>ğŸ“± {{ pedido.cliente?.telefono }}</span>
                  }
                  @if (pedido.cliente?.email) {
                    <small>{{ pedido.cliente?.email }}</small>
                  }
                </div>
              </td>
              <td class="pedido-total">
                ${{ pedido.total | number:'1.2-2' }}
              </td>
              <td>
                <span
                  class="estado-badge"
                  [ngClass]="getEstadoClass(pedido.estado)"
                >
                  {{ getEstadoTexto(pedido.estado) }}
                </span>
              </td>
              <td>
                @if (pedido.id) {
                  <button
                    (click)="verDetalle(pedido.id)"
                    class="btn-ver-detalle"
                  >
                    ğŸ‘ï¸ Ver
                  </button>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</div>

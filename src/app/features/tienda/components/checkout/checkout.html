<div class="checkout-container">
  <div class="checkout-header">
    <h1>Finalizar Pedido</h1>
  </div>

  <div class="checkout-contenido">
    <div class="formulario-section">
      <h2>Datos de Contacto</h2>

      @if (error) {
        <div class="error-mensaje">
          {{ error }}
        </div>
      }

      <form (ngSubmit)="finalizarPedido()" #checkoutForm="ngForm">
        <div class="form-group">
          <label for="nombre">Nombre Completo *</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="cliente.nombre"
            required
            placeholder="Ej: Juan P√©rez"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label for="telefono">Tel√©fono / WhatsApp *</label>
          <div class="telefono-input-group">
            <div class="codigo-area-wrapper">
              <label class="small-label" for="codigoArea">C√≥d. de √°rea</label>
              <select
                [(ngModel)]="codigoArea"
                name="codigoArea"
                id="codigoArea"
                (change)="onCodigoAreaChange()"
                class="form-control codigo-area-select"
                required
              >
                @for (area of codigosArea; track area.codigo) {
                  <option [value]="area.codigo">{{ area.codigo }}</option>
                }
              </select>
            </div>
            <div class="numero-wrapper">
              <label class="small-label" for="numeroTelefono">N√∫mero</label>
              <input
                type="tel"
                id="numeroTelefono"
                name="numeroTelefono"
                [value]="numeroTelefono()"
                (input)="onNumeroChange($event)"
                [attr.maxlength]="digitosPermitidos"
                [placeholder]="digitosPermitidos === 8 ? '12345678' : digitosPermitidos === 7 ? '1234567' : '123456'"
                class="form-control numero-input"
                required
              />
              <small class="digitos-info">{{ numeroTelefono().length }}/{{ digitosPermitidos }}</small>
            </div>
          </div>
          <!-- Input oculto para validaci√≥n del tel√©fono completo -->
          <input
            type="hidden"
            name="telefonoCompleto"
            [(ngModel)]="cliente.telefono"
            required
          />
          <small class="form-hint">üì± Completar sin el 15. WhatsApp: {{ telefonoCompleto || '+549...' }}</small>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="cliente.email"
            placeholder="tu@email.com"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label for="notas">Notas adicionales (opcional)</label>
          <textarea
            id="notas"
            name="notas"
            [(ngModel)]="notas"
            rows="4"
            placeholder="Agrega cualquier comentario o instrucci√≥n especial..."
            class="form-control"
          ></textarea>
        </div>

        <div class="form-actions">
          <button type="button" (click)="abrirCarrito()" class="btn-volver">Volver al Carrito</button>
          <button
            type="submit"
            [disabled]="procesando || !checkoutForm.valid"
            class="btn-confirmar"
          >
            @if (procesando) {
              Procesando...
            } @else {
              Confirmar Pedido
            }
          </button>
        </div>
      </form>
    </div>

    <div class="resumen-section">
      <h2>Resumen del Pedido</h2>

      <div class="items-resumen">
        @for (item of carritoService.items(); track item.producto.id) {
          <div class="item-resumen">
            <div class="item-info">
              <span class="item-nombre">{{ item.producto.nombre }}</span>
              <span class="item-detalle">${{ item.producto.precio | number:'1.2-2' }} c/u x {{ item.cantidad }}</span>
            </div>
            <span class="item-precio">${{ item.subtotal | number:'1.2-2' }}</span>
          </div>
        }
      </div>

      <div class="totales">
        <div class="total-linea">
          <span>Subtotal</span>
          <span>${{ carritoService.subtotal() | number:'1.2-2' }}</span>
        </div>
        <div class="total-linea total">
          <span>Total</span>
          <span>${{ carritoService.subtotal() | number:'1.2-2' }}</span>
        </div>
      </div>

      <div class="info-box">
        <h3>‚ÑπÔ∏è Informaci√≥n Importante</h3>
        <p>Una vez confirmado tu pedido, nuestro equipo lo revisar√° y te contactar√° por WhatsApp para coordinar el pago y la entrega.</p>
      </div>
    </div>
  </div>
</div>

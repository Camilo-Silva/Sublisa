<div class="carrito-container">
  <div class="carrito-header">
    <h1>Mi Carrito</h1>
    @if (carritoService.cantidadTotal() > 0) {
      <button (click)="vaciarCarrito()" class="btn-vaciar">Vaciar Carrito</button>
    }
  </div>

  @if (carritoService.items().length === 0) {
    <div class="carrito-vacio">
      <p>Tu carrito está vacío</p>
      <a routerLink="/" class="btn-continuar">Ver Productos</a>
    </div>
  } @else {
    <div class="carrito-contenido">
      <div class="items-lista">
        @for (item of carritoService.items(); track item.producto.id + (item.talle?.id || '')) {
          <div class="item-carrito">
            <div class="item-imagen">
              <img [src]="item.producto.imagenes?.[0]?.url || 'https://via.placeholder.com/100'" [alt]="item.producto.nombre" />
            </div>

            <div class="item-info">
              <h3>{{ item.producto.nombre }}</h3>
              @if (item.talle) {
                <p class="item-talle">Talle: {{ item.talle.codigo }}</p>
              }
              <p class="item-precio">${{ (item.precio_unitario || item.producto.precio) | number:'1.2-2' }} c/u</p>
              <p class="item-stock-info">{{ getStockDisponible(item) }} disponibles</p>
            </div>

            <div class="item-cantidad">
              <button
                (click)="disminuirCantidad(item.producto.id, item.cantidad, item.talle?.id)"
                class="btn-cantidad"
                [disabled]="item.cantidad <= 1"
              >-</button>
              <span class="cantidad">{{ item.cantidad }}</span>
              <button
                (click)="aumentarCantidad(item.producto.id, item.cantidad, getStockMaximo(item), item.talle?.id)"
                class="btn-cantidad"
                [disabled]="getStockMaximo(item) <= 0"
              >+</button>
            </div>

            <div class="item-subtotal">
              <span class="subtotal">${{ item.subtotal | number:'1.2-2' }}</span>
            </div>

            <button (click)="eliminarProducto(item.producto.id, item.talle?.id)" class="btn-eliminar">
              ×
            </button>
          </div>
        }
      </div>

      <div class="carrito-resumen">
        <h2>Resumen del Pedido</h2>

        <div class="resumen-linea">
          <span>Subtotal</span>
          <span class="valor">${{ carritoService.subtotal() | number:'1.2-2' }}</span>
        </div>

        <div class="resumen-linea total">
          <span>Total</span>
          <span class="valor">${{ carritoService.subtotal() | number:'1.2-2' }}</span>
        </div>

        <div class="resumen-acciones">
          <a routerLink="/productos" class="btn-seguir">Seguir Comprando</a>
          <a routerLink="/checkout" class="btn-finalizar">Finalizar Pedido</a>
        </div>
      </div>
    </div>
  }
</div>
